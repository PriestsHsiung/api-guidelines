# 统一响应码 

api的请求响应码，和标准的http状态码基本一致，按照[RFC 7231](https://tools.ietf.org/html/rfc7231#page-47)的标准定义。

这里我们先明确以下几个概念：

* **请求成功**：api能正确接收请求并按照预期的方式处理请求和返回结果。
* **请求失败**：api无法接收请求，可能由于用户身份无法确定，或者由于api要求必须的参数无法在请求中解析得到等问题。
* **请求处理异常**：api能正确接收请求，但是在处理请求的过程出现无法预期的结果或者未知的异常情况。

三类情况的响应码如下：

|结果|状态码|备注|
|----|----|----|
|请求成功|2xx|请求处理成功|
|请求失败|4xx|请求失败|
|请求处理异常|5xx|请求处理过程出现异常|

在restful api中，一般不会出现重定向的响应，因此本规范不对3xx的响应做定义，也不建议返回3xx的响应码。

---

## 请求成功

在api响应码中，要求所有请求成功处理成功都必须返回2xx类型的响应码，后两位表示具体的操作含义，这里我们对常用的状态说明一下：

|状态码|含义|
|----|----|
|201|已创建，在创建记录成功的时候返回|
|202|已接受请求，正在处理中，通常用于对需要较长处理时间的业务，并且不需要用户等待处理完成的api中|
|204|已接收请求，但服务不需要返回信息|

我们举几个例子来说明：

```
创建学生: POST /student -> 响应码: 201
修改学生: PATCH /student -> 响应码: 204
为所有学生生成历史成绩曲线: POST /statistic/history -> 响应码: 202
```

在上面几个例子中，需要对*为所有学生生成历史成绩曲线*这个业务做一点说明，这个业务是为所有学生生成历史成绩曲线，由于学校学生数量众多，每个学生的历史成绩数量也很多，这个请求可能会耗费大量的时间，对于用户来说，并不需要在这个数据生成之后马上看到，用户可能在其他系统或业务中查看历史成绩曲线，因此这个业务是不需要等业务完成再返回结果的，可以开启一个后台线程进行这个业务，同时直接返回202告诉客户端请求已接受，正在处理中。

---

## 请求失败

api请求失败的时候，要求api必须返回4xx的响应码，后边两位表示具体的错误原因，这里我们对常用的状态进行说明：

|状态码|含义|
|----|----|
|400|服务器不理解请求语法，可能由于非标准的http请求报文导致|
|401|未授权，可能是没有权限访问或无法校验用户身份|
|403|服务器拒绝请求，可能由于特定的条件下此api不能访问，比如api只允许特定时间才能访问|
|404|找不到处理这个url的api|

我们以 查询学生为例：

```
GET /student
```

当请求我们错发为如下方法时：

```
ERROR /student
```

在http标准请求方法中，并没有`ERROR`这种请求方法，这是一个非标准的http请求，这种情况应当返回400的响应码。

出于保护学生信息的目的，我们对查询学生的请求应该进行用户身份验证，如果是没有登录的用户，应该拒绝响应这个请求，这种情况下应当返回响应码401。

假设我们的服务在每天凌晨12点到1点之间，会进行学生信息同步，将教育局的学生信息同步到系统中，在同步的过程学生的信息是不允许查询的，因此在这个时间段内对学生信息查询的请求都应该拒绝，这种情况下应该返回响应码**403**。
