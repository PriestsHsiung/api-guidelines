# 统一响应码 

api的请求响应码，和标准的http状态码基本一致，按照[RFC 7231](https://tools.ietf.org/html/rfc7231#page-47)的标准定义。

这里我们先明确以下几个概念：

* **请求成功**：api能正确接收请求并按照预期的方式处理请求和返回结果。
* **请求失败**：api无法接收请求，可能由于用户身份无法确定，或者由于api要求必须的参数无法在请求中解析得到等问题。
* **请求处理异常**：api能正确接收请求，但是在处理请求的过程出现无法预期的结果或者未知的异常情况。

三类情况的响应码如下：

|状态码|结果|示例|
|----|----|----|
|2xx|请求成功|201、202、200|
|4xx|请求失败|401、404、403|
|5xx|请求处理异常|500、502、503|

在restful api中，一般不会出现重定向的响应，因此本规范不对3xx的响应做定义，也不建议返回3xx的响应码。

---

## 请求成功

|状态码|含义|
|----|----|
|201|已创建，在创建记录成功的时候返回|
|202|已接受请求，正在处理中，通常用于对需要较长处理时间的业务，并且不需要用户等待处理完成的api中|
|204|已接收请求，但服务不需要返回信息|

如：

```
POST /student -> 201            :创建学生
PATCH /student -> 204           :修改学生 
POST /statistic/history -> 202  :为所有学生生成历史成绩曲线
```

*为所有学生生成历史成绩曲线*这个业务一般耗时较长，因此直接返回202，并在后端继续处理业务。

## 请求失败

|状态码|含义|
|----|----|
|400|服务器不理解请求语法，可能由于非标准的http请求报文导致|
|401|未授权，可能是没有权限访问或无法校验用户身份|
|403|服务器拒绝请求，可能由于特定的条件下此api不能访问，比如api只允许特定时间才能访问|
|404|找不到处理这个url的api|

我们以查询学生为例：

```
GET /student -> 400 :请求不是标准http请求时
GET /student -> 401 :用户没有登录时
GET /student -> 404 :没有这个api时
```

## 请求处理异常

|状态码|含义|
|500|服务器内部异常，一般是服务器未预期的异常|
|502|网关错误|
|503|服务不可用|
|504|网关超时|

品高api网关已经对**502**，**503**，**504**的状态进行处理了，我们的api一般不需要返回这几种状态。

当api接收http请求之后，会按照业务逻辑对请求进行处理，某些情况下可能会出现无法预料的问题，比如当用户创建学生信息的时候，由于网络异常导致数据库插入学生信息失败，这种情况是无法预料的，此时api应当返回**500**的响应码给客户端。